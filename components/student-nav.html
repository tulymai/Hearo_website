<!-- Student Navigation Bar -->
<nav class="student-nav">
  <div class="container">
    <div class="student-nav-content">
      <div class="nav-left">
        <a href="student-portal.html" class="nav-item" data-page="portal">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            <polyline points="9 22 9 12 15 12 15 22" />
          </svg>
          <span>Dashboard</span>
        </a>

        <a
          href="lesson-viewer.html?lesson=7"
          class="nav-item"
          data-page="lesson"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polygon points="5 3 19 12 5 21 5 3" />
          </svg>
          <span>Học bài</span>
        </a>

        <a href="course-resources.html" class="nav-item" data-page="resources">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
            />
            <polyline points="14 2 14 8 20 8" />
          </svg>
          <span>Tài liệu</span>
        </a>

        <a href="student-profile.html" class="nav-item" data-page="profile">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
            <circle cx="12" cy="7" r="4" />
          </svg>
          <span>Trang cá nhân</span>
        </a>
      </div>

      <div class="nav-right">
        <div class="nav-progress">
          <span class="progress-text">7/21 bài</span>
          <div class="progress-mini-bar">
            <div class="progress-mini-fill" style="width: 33%"></div>
          </div>
        </div>

        <div class="nav-user" onclick="toggleUserMenu(event)">
          <img
            src="https://i.pravatar.cc/80?img=5"
            alt="User"
            class="user-avatar"
            id="navUserAvatar"
          />
          <span class="user-name-nav">Phương Anh</span>
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            class="chevron-icon"
          >
            <polyline points="6 9 12 15 18 9" />
          </svg>
        </div>

        <!-- User Dropdown Menu -->
        <div class="user-menu" id="userMenu">
          <div class="user-menu-header">
            <img
              src="https://i.pravatar.cc/80?img=5"
              alt="User"
              class="menu-user-avatar"
              id="menuUserAvatar"
            />
            <div class="menu-user-info">
              <strong>Phương Anh</strong>
              <span>phuonganh@email.com</span>
            </div>
          </div>

          <div class="menu-divider"></div>

          <a href="student-portal.html" class="user-menu-item">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
              <polyline points="9 22 9 12 15 12 15 22" />
            </svg>
            <span>Dashboard</span>
          </a>

          <a href="student-profile.html" class="user-menu-item">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
            <span>Trang cá nhân</span>
          </a>

          <a href="student-profile.html#courses" class="user-menu-item">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
              <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
            </svg>
            <span>Khóa học của tôi</span>
          </a>

          <a href="student-profile.html#certificates" class="user-menu-item">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
              <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
            <span>Chứng chỉ</span>
          </a>

          <a href="student-profile.html#billing" class="user-menu-item">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2" />
              <line x1="1" y1="10" x2="23" y2="10" />
            </svg>
            <span>Lịch sử thanh toán</span>
          </a>

          <a href="student-profile.html#settings" class="user-menu-item">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="3" />
              <path
                d="M12 1v6m0 6v6m5.66-13.66l-4.24 4.24m0 6.36l4.24 4.24M23 12h-6m-6 0H1m18.36-5.66l-4.24 4.24m-6.36 0l-4.24-4.24"
              />
            </svg>
            <span>Cài đặt</span>
          </a>

          <div class="menu-divider"></div>

          <a href="courses.html" class="user-menu-item">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.35-4.35" />
            </svg>
            <span>Khám phá khóa học</span>
          </a>

          <div class="menu-divider"></div>

          <a
            href="index.html"
            class="user-menu-item logout"
            onclick="handleLogout(event)"
          >
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
              <polyline points="16 17 21 12 16 7" />
              <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
            <span>Đăng xuất</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</nav>

<style>
  /* Student Navigation */
  .student-nav {
    position: sticky;
    top: 60px;
    background: rgba(2, 44, 34, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(34, 197, 94, 0.2);
    z-index: 90;
    padding: 0;
  }

  .student-nav-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
  }

  .nav-left {
    display: flex;
    gap: 8px;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    border-radius: 10px;
    color: var(--muted);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.95rem;
    transition: all 0.3s;
    border: 1px solid transparent;
  }

  .nav-item:hover {
    background: rgba(34, 197, 94, 0.1);
    color: #d1fae5;
  }

  .nav-item.active {
    background: rgba(34, 197, 94, 0.15);
    color: var(--primary);
    border-color: rgba(34, 197, 94, 0.3);
  }

  .nav-item svg {
    flex-shrink: 0;
  }

  .nav-right {
    display: flex;
    align-items: center;
    gap: 24px;
    position: relative;
  }

  .nav-progress {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .progress-text {
    font-size: 0.9rem;
    color: var(--muted);
    white-space: nowrap;
  }

  .progress-mini-bar {
    width: 100px;
    height: 6px;
    background: rgba(34, 197, 94, 0.2);
    border-radius: 999px;
    overflow: hidden;
  }

  .progress-mini-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--accent));
    border-radius: 999px;
    transition: width 0.5s ease;
  }

  .nav-user {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 6px 12px 6px 6px;
    background: rgba(34, 197, 94, 0.1);
    border-radius: 999px;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
  }

  .nav-user:hover {
    background: rgba(34, 197, 94, 0.15);
  }

  .user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 2px solid var(--primary);
    object-fit: cover;
  }

  .user-name-nav {
    font-size: 0.9rem;
    color: #f0fdf4;
    font-weight: 600;
  }

  .chevron-icon {
    color: var(--primary);
    transition: transform 0.3s;
  }

  .nav-user:hover .chevron-icon {
    transform: translateY(2px);
  }

  /* User Menu Dropdown */
  .user-menu {
    position: absolute;
    top: calc(100% + 12px);
    right: 0;
    min-width: 280px;
    background: rgba(2, 44, 34, 0.98);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(34, 197, 94, 0.3);
    border-radius: 16px;
    padding: 12px;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1000;
  }

  .user-menu.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .user-menu-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: rgba(34, 197, 94, 0.08);
    border-radius: 12px;
    margin-bottom: 8px;
  }

  .menu-user-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 2px solid var(--primary);
    object-fit: cover;
  }

  .menu-user-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
    flex: 1;
    min-width: 0;
  }

  .menu-user-info strong {
    font-size: 1rem;
    color: #f0fdf4;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .menu-user-info span {
    font-size: 0.8rem;
    color: var(--muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .user-menu-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 14px;
    color: #d1fae5;
    text-decoration: none;
    border-radius: 10px;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.3s;
  }

  .user-menu-item:hover {
    background: rgba(34, 197, 94, 0.15);
    color: var(--primary);
    transform: translateX(4px);
  }

  .user-menu-item svg {
    flex-shrink: 0;
    color: currentColor;
  }

  .user-menu-item.logout {
    color: #ef4444;
  }

  .user-menu-item.logout:hover {
    background: rgba(239, 68, 68, 0.15);
    color: #ef4444;
  }

  .menu-divider {
    height: 1px;
    background: rgba(34, 197, 94, 0.2);
    margin: 8px 0;
  }

  /* Responsive */
  @media (max-width: 968px) {
    .nav-item span {
      display: none;
    }

    .nav-item {
      padding: 10px 12px;
    }

    .progress-text,
    .user-name-nav {
      display: none;
    }

    .progress-mini-bar {
      width: 60px;
    }

    .chevron-icon {
      display: none;
    }

    .nav-user {
      padding: 6px;
    }

    .user-menu {
      right: -100px;
      min-width: 260px;
    }
  }

  @media (max-width: 640px) {
    .nav-progress {
      display: none;
    }

    .user-menu {
      right: -140px;
    }
  }
</style>

<script>
  // Toggle user menu
  function toggleUserMenu(event) {
    event.stopPropagation();
    const menu = document.getElementById("userMenu");
    menu.classList.toggle("active");
  }

  // Close menu when clicking outside
  document.addEventListener("click", (event) => {
    const menu = document.getElementById("userMenu");
    const navUser = document.querySelector(".nav-user");

    if (menu && !navUser.contains(event.target)) {
      menu.classList.remove("active");
    }
  });

  // Handle logout
  function handleLogout(event) {
    event.preventDefault();

    const confirmed = confirm("Bạn có chắc chắn muốn đăng xuất?");

    if (confirmed) {
      // Clear user data
      localStorage.removeItem("userData");
      localStorage.removeItem("orderData");
      localStorage.removeItem("courseProgress");

      // Show notification
      alert("✅ Đã đăng xuất thành công!");

      // Redirect to home
      window.location.href = "index.html";
    }
  }

  // Highlight active nav item
  document.addEventListener("DOMContentLoaded", () => {
    const currentPage = document.body.dataset.page;
    const navItems = document.querySelectorAll(".nav-item");

    navItems.forEach((item) => {
      if (item.dataset.page === currentPage) {
        item.classList.add("active");
      }
    });

    // Load user data
    loadNavUserData();
  });

  // Load user data into navigation
  function loadNavUserData() {
    // Load from localStorage
    const userData = JSON.parse(localStorage.getItem("userData") || "{}");
    const orderData = JSON.parse(localStorage.getItem("orderData") || "{}");
    const savedAvatar = localStorage.getItem("userAvatar");

    // Get user name
    let userName = "Học viên";
    let userEmail = "";

    if (userData.fullname) {
      userName = userData.fullname.split(" ")[0]; // First name
      userEmail = userData.email || "";
    } else if (orderData.fullname) {
      userName = orderData.fullname.split(" ")[0];
      userEmail = orderData.email || "";
    }

    // Update UI
    const userNameElements = document.querySelectorAll(".user-name-nav");
    userNameElements.forEach((el) => {
      el.textContent = userName;
    });

    const menuUserInfo = document.querySelector(".menu-user-info");
    if (menuUserInfo) {
      menuUserInfo.querySelector("strong").textContent =
        userData.fullname || orderData.fullname || "Học viên";
      menuUserInfo.querySelector("span").textContent =
        userEmail || "email@example.com";
    }

    // Update avatars
    if (savedAvatar) {
      const avatars = document.querySelectorAll(
        "#navUserAvatar, #menuUserAvatar"
      );
      avatars.forEach((avatar) => {
        avatar.src = savedAvatar;
      });
    }

    // Update progress
    const progress = JSON.parse(localStorage.getItem("courseProgress") || "{}");
    if (progress.currentLesson && progress.totalCompleted) {
      const percent = Math.round((progress.totalCompleted / 21) * 100);
      const progressText = document.querySelector(".progress-text");
      const progressFill = document.querySelector(".progress-mini-fill");

      if (progressText) {
        progressText.textContent = `${progress.totalCompleted}/21 bài`;
      }

      if (progressFill) {
        progressFill.style.width = `${percent}%`;
      }
    }
  }
</script>
